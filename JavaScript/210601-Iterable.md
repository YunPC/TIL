# 이터러블

## 1. 이터레이션 프로토콜

이터레이션 프로토콜은 이터러블을 만들기 위한 규칙이다. 이 규칙은 ECMAScript에 정의되어 있다.

이터레이션 프로토콜에는 이터러블 프로토콜과 이터레이터 프로토콜이 있다.

- 이터러블 프로토콜(iterable protocol)
Symbol.iterator를 프로퍼티 키로 사용한 메서드를 호출하면 이터레이터 프로토콜을 준수한 이터레이터를 반환한다. 이터러블 프로토콜을 지킨 객체를 이터러블이라 한다. 이 객체는 for...of문으로 순회할 수 있고 스프레드 문법과 배열 디스트럭처링 할당의 대상으로 사용할 수 있다.

- 이터레이터 프로토콜(iterator protocol)
이터레이트는 next 메서드를 호출하며 value와 done프로퍼티를 갖는 이터레이터 리절트 객체를 반환한다. 이터레이터 프로토콜을 준수한 객체를 이터레이터라 한다. 이 객체는 이터러블 요소를 탐색하기 위한 포인터 역할을 한다.

### 1.1 이터러블

Symbol.iterator 메서드를 호출할 수 없는 객체는 for...of문으로 순회가 불가능하며 스프레드 문법과 배열 디스트럭처링 할당이 불가능하다.

다만 스프레드 문법은 일반 객체에도 적용할 수 있다. 프로퍼티 스프레드 제안은 2021년 6월 현재 TC39 프로세서의 stage4단계에 있다.

### 1.2 이터레이터

Symbol.iterator 메서드가 이터레이터를 반환한다. 이 이터레이터는 next 메서드를 갖는다. next메서드는 이터레이터 리절트 객체를 반환한다. 이 객체의 프로퍼티로 value와 done을 가진다. value는 현재 순회중인 이터러블의 값이며 done은 순회 완료 여부를 나타낸다.

## 2. 빌트인 이터러블

자바스크립트는 다음과 같은 빌트인 이터러블을 제공한다. 이들은 모두 이터레이션 프로토콜을 준수한다.

|빌트인 이터러블|프로퍼티 키가 Symbol.iterator인 메서드|
|--|--|
|Array|Array.prototype[Symbol.iterator]|
|String|String.prototype[Symbol.iterator]|
|Map|Map.prototype[Symbol.iterator]|
|Set|Set.prototype[Symbol.iterator]|
|TypedArray|TypedArray.prototype[Symbol.iterator]|
|arguments|arguments.prototype[Symbol.iterator]|
|DOM 컬렉션|NodeList.prototype[Symbol.iterator], HTMLCollection.prototype[Symbol.iterator]|

## 3. for...of 문

for...of 문은 이터러블을 순회하면서 이터러블 요소를 변수에 할당한다. 

이와 비슷한 for...in문은 프로퍼티 어트리뷰트 `[[Enumerable]]`이 true인 값만 열거한다. 이때 프로퍼티키가 심벌인 키는 열거하지 않는다.

for...of문은 내부적으로 이터러블을 순회하면서 이터레이트 객체의 value 프로퍼티 값을 for...of문의 변수에 할당한다. 이 과정을 done값이 true일 때까지 반복한다.

for...of문에서는 break, continue, return 문을 사용할 수 있다.

이터러블의 인덱스가 필요하다면 Array.prototype.keys를 사용하고 두 값이 다 필요하다면 Array.prototype.entries메서드를 사용한다. 두 메서드는 모두 이터러블 객체를 반환한다.

## 4. 이터러블과 유사 배열 객체

유사 배열 객체는 프로퍼티 키가 인덱스이고 length프로퍼티를 갖는 객체를 말한다. 유사 배열 객체는 for문으로 순회할 수 있고 인덱스로 프로퍼티 값에 접근할 수 있다.

하지만 이터러블이 아니기 때문에 for...of 문으로 순회할 수 없다. 

유사 배열 객체이면서 이터러블한 객체로는 arguments, NodeList, HTMLCollection이 있다. 이들은 ES6 이전에 유사배열 객체였다가 Symbol.iterable이 추가 구현되면서 이터러블이 되었다.

배열도 마찬가지로 ES6에서 이터러블하게 되었다. 

유사배열 객체를 이터러블 하게 만드는 방법 중 하나는 Arrray.from 메서드를 사용하는 것이다.

## 5. 이터레이션 프로토콜의 중요성

이터러블이라면 for...of문, 스프레드 문법, 배열 디스트럭처링 할당을 사용할 수 있다. 사용법을 일원화함으로써 데이터 소비자가 효율적으로 다양한 데이터 공급자를 사용할 수 있도록 데이터 소비자와 데이터 공급자를 연결하는 인터페이스의 역할을 한다.

## 6. 사용자 정의 이터러블

### 6.1 사용자 정의 이터러블 구현

일반 객체도 이터레이션 프로토콜을 준수하면 이터러블로 만들 수 있다. 

### 6.2 이터러블을 생성하는 함수

Symbol.iterator 메서드를 구현한다.

### 6.3 이터러블이면서 이터레이터인 객체를 생성하는 함수

객체를 반환한다. 이 객체에는 Symbol.iterator 메서드와 next 메서드를 소유하나다. next 메서드는 이터레이터 리절트 객체를 반환한다.

### 6.4 무한 이터러블과 지연 평가

무한 이터러블을 생성하기 위해선 done 프로퍼티를 생략하면 된다.

이터러블은 데이터 공급자의 역할을 한다. 원래 모든 데이터를 메모리에 미리 확보한 다음 데이터를 공급한다. 어떤 이터러블은 지연 평가(lazy evaluation)을 통해 값을 생성한다. 지연 평가란 미리 데이터를 생성하지 않다가 데이터가 필요한 시점이 될 때 데이터를 생성하는 기법이다.

for..of문의 경우 이터러블을 순회할 때 이터레이터의 next 메서드를 호출하며 이때 데이터가 생성된다.

지연 평가를 사용하면 불필요한 데이터를 생성하지 않고 필요한 데이터를 필요할 때 생성하므로 빠른 실행속도와 메모리 소비가 줄며 무한을 표현할 수 있다는 장점이 있다.